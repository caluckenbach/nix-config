{ homebrew-core, homebrew-cask, homebrew-twilio, config, lib, ... }: let
  inherit (lib) enabled;
in {
  homebrew = enabled {
    onActivation = {
      autoUpdate = false;
      cleanup    = "zap";
    };

    # TODO: Periodically check if these become available/fixed in nixpkgs
    brews = [
      "gitui"  # Broken in nixpkgs on aarch64-darwin
      "livekit-cli"
      "mas"
      "mole"
      "twilio"
    ];

    casks = [
      "figma"
      "ghostty"
      "microsoft-teams"
      "protonvpn"
      "raycast"
      "spotify"
      "sublime-text"
      "telegram"
    ];

    masApps = {
      "Maccy"      = 1527619437;
      "MeetingBar" = 1532419400;
      "Theine"     = 955848755;
      "Xcode"      = 497799835;
    };
  };

  nix-homebrew = enabled {
    user = config.system.primaryUser;
    autoMigrate = true;

    taps = {
      "homebrew/homebrew-core" = homebrew-core;
      "homebrew/homebrew-cask" = homebrew-cask;
      "twilio/homebrew-brew"   = homebrew-twilio;
    };

    mutableTaps = false;
  };
}
